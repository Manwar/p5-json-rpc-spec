use lib 'lib';
use Path::Tiny qw(path);
use Capture::Tiny qw(capture_stdout);

desc 'install perl modules';
task install => sub {
    sh q(cpanm --with-all-features --installdeps .);
};

desc 'test coverage';
task coverage => sub {
    sh q{perl Build.pl};
    sh q{./Build build};
    sh q{cover -test};
    sh q{open cover_db/coverage.html};
};

desc 'NYTProf';
task profile => sub {
    sh q{PERL5OPT=-d:NYTProf perl -Ilib t/02_specification.t};
    sh q{nytprofhtml --open};
};

namespace generate => sub {
    desc 'generate cpanfile';
    task cpanfile => sub {
        my $stdout = capture_stdout sub {
            sh q(scan-prereqs-cpanfile --ignore=public,templates,var);
        };
        path('cpanfile')->spew($stdout);
    };
};

task default => sub { sh q{daiku -T} };
